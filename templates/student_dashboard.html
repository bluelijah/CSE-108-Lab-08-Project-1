{% extends "base.html" %}
{% block title %}Student Dashboard · ACME{% endblock %}

{% block content %}
  <div class="card" style="margin-bottom:20px;">
    <div class="card-header">
      <h2 class="card-title">Welcome {{ full_name }}!</h2>
      <span class="badge">Student Portal</span>
    </div>
  </div>

  <!-- Tabs -->
  <div class="tabs">
    <button class="tab active" data-tab="mine" onclick="showTab('mine')">Your Courses</button>
    <button class="tab" data-tab="add" onclick="showTab('add')">Add Courses</button>
  </div>

  <!-- Your Courses -->
  <section id="tab-mine" class="card tab-panel">
    <div class="card-header"><h3 class="card-title">Your Courses</h3></div>
    <div class="table-wrap">
      <table>
        <thead>
          <tr><th>Course Name</th><th>Teacher</th><th>Time</th><th>Students</th><th></th></tr>
        </thead>
        <tbody>
          {% for c in my_courses %}
            <tr>
              <td>{{ c.course_name }}</td>
              <td>{{ c.teacher }}</td>
              <td>{{ c.time }}</td>
              <td>{{ c.enrolled }}/{{ c.capacity }}</td>
              <td style="text-align:right;">
                <form method="post" action="/api/unenroll">
                  <input type="hidden" name="course_id" value="{{ c.id }}">
                  <button class="btn btn-ghost" type="submit">Remove</button>
                </form>
              </td>
            </tr>
          {% else %}
            <tr><td colspan="5" style="text-align:center;">You’re not enrolled in any courses yet.</td></tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </section>

  <!-- Add Courses -->
  <section id="tab-add" class="card tab-panel is-hidden">
    <div class="card-header"><h3 class="card-title">Add Courses</h3></div>
    <div class="table-wrap">
      <table>
        <thead>
          <tr><th>Course</th><th>Teacher</th><th>Time</th><th>Seats</th><th></th></tr>
        </thead>
        <tbody>
          {% for c in available_courses %}
            <tr>
              <td>{{ c.course_name }}</td>
              <td>{{ c.teacher }}</td>
              <td>{{ c.time }}</td>
              <td>{{ c.enrolled }}/{{ c.capacity }}</td>
              <td style="text-align:right;">
                <form method="post" action="/api/enroll">
                  <input type="hidden" name="course_id" value="{{ c.id }}">
                  <button class="btn btn-primary" type="submit"
                          {% if c.is_full or c.is_enrolled %}disabled{% endif %}>
                    {% if c.is_enrolled %}Enrolled{% elif c.is_full %}Full{% else %}Add{% endif %}
                  </button>
                </form>
              </td>
            </tr>
          {% else %}
            <tr><td colspan="5" style="text-align:center;">No courses available.</td></tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </section>
{% endblock %}

{% block scripts %}
<script>
  // remember last selected tab per session
  const KEY = 'studentTab';

  function showTab(which) {
    document.querySelectorAll('.tab').forEach(t => {
      t.classList.toggle('active', t.dataset.tab === which);
    });
    document.querySelectorAll('.tab-panel').forEach(p => {
      p.classList.toggle('is-hidden', p.id !== 'tab-' + which);
    });
    try { sessionStorage.setItem(KEY, which); } catch (e) {}
  }

  // restore tab on load
  (function () {
    try {
      const last = sessionStorage.getItem(KEY);
      if (last === 'add') showTab('add'); else showTab('mine');
    } catch (e) { showTab('mine'); }
  })();
</script>
{% endblock %}
 